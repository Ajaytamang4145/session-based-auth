This is basically my statefull auth process.
